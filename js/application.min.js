var SANDBOX=!1,HOST_URL="",HOST_URL=SANDBOX?"http://sandbox.hotprintcloud.com/":"http://www.hotprintcloud.com/",TEMP_DIR="proxy/tmp/",PHONE_NAME="iphone5",LAYOUT_NAME="layout_3",PHONE_COLOR="white",layout_ox=410,layout_oy=Math.floor(0.1*$(window).height()),CORNER_OPT=0.1,isCornerFading=!1,PAGE="Design",TITLE_NAME="",maskImg,isMenuEntry=!1,_init,_getUserData,_displayUserData,_instaCrossLogin,_instalogin,_instalogout,_getUserRecent,_facebookPhotoAlbum,_fblogin,_fbCrossLogin,_fblogout,_logout,_loadLayout,
access_token,user_id,source_type;
(function(){function a(a){!1==isMenuEntry&&(isMenuEntry=!0,menuLoadLayout(a.data.param))}function d(a){!1==isMenuEntry&&(isMenuEntry=!0,menuLoadPhone(a.data.param))}function c(a){!1==isMenuEntry&&(isMenuEntry=!0,menuLoadColor(a.data.param))}function f(){$("#save-design").unbind("click");$("#random-design").unbind("click");$("#clear-design").unbind("click");$("#start-design").unbind("click");$("#my-gallery").unbind("click");$("#logout").unbind("click");$("#go-to-my-gallery").unbind("click");$("#save-design").bind("click",
saveImg);$("#random-design").bind("click",randomDesign);$("#clear-design").bind("click",clearDesign);$("#start-design").bind("click",startDesign);$("#my-gallery").bind("click",openGallery);$("#logout").bind("click",_logout);$("#go-to-my-gallery").bind("click",openGallery)}$.extend({instagramr:function(){_init()}});_init=function(){$("html").removeClass("no-js");$("body").addClass("not-logged-in");$("#login").click({isPopup:!1},_instalogin);$("#login2").click({isPopup:!1},_fblogin);$("#facebook-source-login").click({isPopup:!0},
_fblogin);$("#instagram-source-login").click({isPopup:!0},_instalogin);$(".layout_item").each(function(){$(this).click({param:$(this).attr("id")},a)});$(".phone_item").each(function(){$(this).click({param:$(this).attr("id")},d)});$(".color_item").each(function(){$(this).click({param:$(this).attr("id")},c)});if(""!=location.hash){var g=location.hash.split("&")[0],b=location.hash.split("&")[1],e=location.hash.split("&")[2];if(b){if("instagram"==b.split("=")[1])_instaCrossLogin(g.split("=")[1]);else if("facebook"==
b.split("=")[1])_fbCrossLogin(g.split("=")[1]);else{$.removeCookie("source");$.removeCookie("access_token");parent.location.hash="";return}parent.location.hash="";$.cookie("access_token",g.split("=")[1]);e&&"b"==e.split("=")[0]&&($("body").append('<div class="modalOverlay"></div>'),"succeed"==e.split("=")[1]?new Messi("\u60a8\u5df2\u7d93\u4ed8\u6b3e\u6210\u529f! \u53ef\u4ee5\u96a8\u6642\u6aa2\u8996\u51fa\u8ca8\u9032\u5ea6<br>\u6216\u8005\u7e7c\u7e8c\u8a2d\u8a08\u65b0\u7684\u4f5c\u54c1\u3002",{title:"\u606d\u559c!",
buttons:[{id:0,label:"Close",val:"C"}],callback:function(){$(".modalOverlay").remove();simpleCart.empty()}}):new Messi("\u525b\u525b\u7684\u4ed8\u6b3e\u4e26\u672a\u6210\u529f\uff0c\u60a8\u7684\u4fe1\u7528\u5361\u6c92\u6709\u7522\u751f\u4efb\u4f55\u6263\u6b3e\u8a18\u9304<br><br>\u8acb\u78ba\u8a8d\u4ed8\u6b3e\u6d41\u7a0b\u662f\u5426\u6709\u8aa4\uff0c\u6216\u7a0d\u5f8c\u518d\u8a66\u3002",{title:"\u4ed8\u6b3e\u5931\u6557",buttons:[{id:0,label:"Close",val:"C"}],callback:function(){$(".modalOverlay").remove()}}))}else $.removeCookie("source"),
$.removeCookie("access_token")}else $.cookie("access_token")&&$.cookie("source")&&("instagram"==$.cookie("source")?_instaCrossLogin($.cookie("access_token")):"facebook"==$.cookie("source")?_fbCrossLogin($.cookie("access_token")):($.removeCookie("source"),$.removeCookie("access_token"),parent.location.hash=""))};_logout=function(){$("body").append('<div class="modalOverlay"></div>');$.removeCookie("source");$.removeCookie("access_token");$.removeCookie("user_id");$.removeCookie("phone_name");$.removeCookie("layout_name");
$.removeCookie("phone_color");_fblogout(_instalogout)};var h;_instalogin=function(a){$(".recent").find(".draggable").each(function(){$(this).remove();$(this)[0]=null});h="";var b="https://instagram.com/oauth/authorize/?client_id=c4b0c9a61cc24efbb4cd5feb71be67b8&amp;redirect_uri="+HOST_URL+"instaredirect.html&amp;response_type=token";if(!0==a.data.isPopup)return window.open(b,"hotprintCloud","height=400,width=600,left=10,top=10,resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no,directories=no,status=yes"),
!1;window.location=b};_instalogout=function(){$.ajax({url:"https://instagram.com/accounts/logout/",dataType:"jsonp",error:function(){location.reload()},success:function(){location.reload()}})};_instaCrossLogin=function(a){access_token=a;source_type="instagram";null==$.cookie("source")&&$.cookie("source",source_type);$("body").addClass("logged-in");_getUserData();f()};_getUserData=function(){$.ajax({dataType:"jsonp",url:"https://api.instagram.com/v1/users/self",data:{access_token:access_token}}).success(_displayUserData)};
_displayUserData=function(a){"200"!=a.meta.code?($.removeCookie("source"),$.removeCookie("access_token"),$("body").removeClass("logged-in"),$("body").addClass("not-logged-in")):(user_id=a.data.id,"instagram"==$.cookie("source")&&($.cookie("user_id",user_id),$.cookie("user_type","instagram"),$(".open").html("").fadeIn(300).append(a.data.username)),h="",_getUserRecent())};_getUserRecent=function(a){0<$("#fbalbums").length&&$("#fbalbums").attr("disabled","disabled");$.ajax({dataType:"jsonp",url:null!=
a?a:"https://api.instagram.com/v1/users/"+user_id+"/media/recent",data:{access_token:access_token,count:100}}).success(_displayUserRecent)};_displayUserRecent=function(a){for(var b=0;b<a.data.length;b++)h+="<li><a><img src='loader.gif' delay_src=\""+a.data[b].images.standard_resolution.url+'" delay_src_h="'+a.data[b].images.standard_resolution.url+"\" id='recent_instaimg"+b+"' class='draggable draggable-h draggable-w gallery-pool' /></a></li>";"undefined"!=typeof a.pagination.next_url?_getUserRecent(a.pagination.next_url):
gallery_bar_setting(h)};var e;_fblogin=function(a){$(".recent").find(".draggable").each(function(){$(this).remove();$(this)[0]=null});e="";var b="http://www.facebook.com/dialog/oauth/?client_id=290426614419964&redirect_uri="+HOST_URL+"fbredirect.html&response_type=token&scope=user_photos";if(!0==a.data.isPopup)return window.open(b,"hotprintCloud","height=600,width=800,left=10,top=10,resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no,directories=no,status=yes"),!1;window.location=b};_fbCrossLogin=
function(a){$("#facebook-source").html("");access_token=a;source_type="facebook";null==$.cookie("source")&&$.cookie("source",source_type);$("body").addClass("logged-in");f();FB.api("/me?access_token="+access_token+"&fields=albums,id,name",function(a){!a||a.error?($.removeCookie("source"),$.removeCookie("access_token"),$("body").removeClass("logged-in"),$("body").addClass("not-logged-in")):(user_id=a.id,"facebook"==$.cookie("source")&&($.cookie("user_id",user_id),$.cookie("user_type","facebook"),$(".open").html("").fadeIn(300).append(a.name)),
$select=$("<select></select>"),$select.attr("id","fbalbums"),$.each(a.albums.data,function(a,b){$select.append($("<option></option>").attr("value",b.id).text(b.name))}),$("#facebook-source").append($select),$select.change(function(){$(".recent").find(".draggable").each(function(){$(this).remove();$(this)[0]=null});e="";_facebookPhotoAlbum()}),e="",_facebookPhotoAlbum())})};_fblogout=function(a){FB.getLoginStatus(function(b){"connected"===b.status?FB.logout(function(){"undefined"!=typeof a&&a()}):
"undefined"!=typeof a&&a()})};_facebookPhotoAlbum=function(a){var b=$.extend({facebookAlbumId:$("#fbalbums :selected").val(),photoLimit:"500",randomOrder:"false"}),c=b.facebookAlbumId,d=b.photoLimit;$.getJSON(null!=a?a+"&callback=?":"https://graph.facebook.com/"+c+"/photos?access_token="+access_token+"&limit=0&callback=?",function(a){0<$("#fbalbums").length&&$("#fbalbums").attr("disabled",!1);var b=d;a.data.length<b&&(b=a.data.length);for(i=0;i<b;i++){var h=a.data[i];e=h.width>h.height?e+("<li><a><img src='loader.gif' delay_src=\""+
h.source+'" delay_src_h="'+h.images[0].source+"\" id='recent_fbimg"+c+i+"' class='draggable draggable-h gallery-pool'/></a></li>"):e+("<li><a><img src='loader.gif' delay_src=\""+h.source+'" delay_src_h="'+h.images[0].source+"\" id='recent_fbimg"+c+i+"' class='draggable draggable-w gallery-pool'/></a></li>")}"undefined"!=typeof a.paging?"undefined"!=typeof a.paging.next?_facebookPhotoAlbum(a.paging.next):gallery_bar_setting(e):gallery_bar_setting(e)})}})(jQuery);
function show_price(a){$.post("db/bom.php",{part_name:a},function(a){"ok"==a.result&&$("#price_no").html(a.value)},"json")}
function gallery_bar_setting(a){$(".ad-thumb-list").html("").fadeIn(300).append(a);$(".gallery-pool").one("load",function(){$(this).attr("src",$(this).attr("delay_src"))}).each(function(){this.complete&&$(this).load()});$(".ad-gallery").adGallery({thumb_opacity:1});$(".ad-gallery").css("width",$(window).width()-50+"px");$(".ad-gallery").css({margin:"0 auto","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"});
$.browser.msie||$(".gallery-pool").hover(function(){$(this).css("opacity",0);var a=$(this).clone();a.css({left:$(this).position().left,top:$(this).position().top,width:$(this).css("width"),height:$(this).css("height"),position:"absolute",opacity:1,"box-shadow":"3px 3px 4px black","pointer-events":"none"});$(this).after(a);a.animate({top:"-=20",left:"-=5",width:"+=10",height:"+=10"},"fast")},function(){$(this).css("opacity",1);$(this).next().remove()});$(".gallery-pool").draggable({scroll:!1,cursor:"move",
helper:"clone",cursorAt:{left:35,top:35},revert:"invalid",drag:function(a,c){c.helper.css("z-index","1000");c.helper.css("opacity","0.7");0<=$(this).attr("class").indexOf("ui-draggable-dragging")&&$(".ui-draggable-dragging").css("z-index","1000");c.helper.height($(this).data("oh"));c.helper.width($(this).data("ow"))},start:function(){disable_scroll();$(".layout_corner").css("z-index","998");$(".layout_corner").stop(!0,!0).animate({opacity:1});$(this).data("oh",Math.round(0.7*$(this).height()));$(this).data("ow",
Math.round(0.7*$(this).width()))},stop:function(){enable_scroll();isCornerFading=!0;$(".layout_corner").animate({opacity:CORNER_OPT},{complete:function(){$(".layout_corner").each(function(){0<$(this).children(".spinning").length&&$(this).css("opacity","0")});isCornerFading=!1}})}})}
function clearCorner(a){"undefined"!=typeof a.attr("class")&&0<=a.attr("class").indexOf("layout_corner")&&(a.children(".draggable").each(function(){$(this).remove();$(this)[0]=null}),a.css("cursor","default"),"canvas_appended"==a.next().attr("class")&&"canvas"==a.next()[0].tagName.toLowerCase()&&(a.next().remove(),a.next()[0]=null),a.removeClass("removed"),a.css("z-index","998"),$(".layout_corner").animate({opacity:CORNER_OPT},{complete:function(){$(".layout_corner > .draggable").parent().css("opacity",
"0")}}))}
function setDnD(a,d,c){var f=function(a,c){a.data("zdx",c.data("zdx"));a.data("zdy",c.data("zdy"));a.data("zw",c.data("zw"));a.data("zh",c.data("zh"));a.data("corner",c.data("corner"));if("undefined"!=typeof a.attr("src")&&(0<=a.attr("src").indexOf("http://")||0<=a.attr("src").indexOf("https://"))){var d=HOST_URL+TEMP_DIR+a.attr("src").replace(/\//g,"+");a.data("src",d)}else a.data("src",c.data("src"));a.data("oh",c.data("oh"));a.data("ow",c.data("ow"))};$(".layout_corner").droppable({accept:".draggable",tolerance:"pointer",
drop:function(h,e){if("undefined"!=typeof $(e.draggable).parent().attr("id")&&!(0<$(this).children(".spinner").length)){$(this).droppable("disable");enable_scroll();"canvas"==$(this).next()[0].tagName.toLowerCase()&&($(this).next().remove(),$(this).next()[0]=null);if($(e.draggable).parent().attr("id")!=$(this).attr("id"))$(this).html(""),$(this).append($(e.draggable).clone()),$(e.draggable).parent().hasClass("layout_corner")&&removeUnclearWarning($(e.draggable).parent().attr("id")),removeUnclearWarning($(this).attr("id")),
f($(this).children(".draggable"),$(e.draggable)),clearCorner($(e.draggable).parent());else{var g=$("<img>");f(g,$(e.draggable));$(this).html("");$(this).append($(e.draggable).clone());removeUnclearWarning($(this).attr("id"));f($(this).children(".draggable"),g)}$(this).children(".draggable").removeClass("gallery-pool");!1==isCornerFading&&$(".layout_corner").animate({opacity:CORNER_OPT},{complete:function(){$(".layout_corner > .draggable").parent().css("opacity","0")}});$(this).children(".draggable").css({position:"relative",
top:"0px",left:"0px",width:$(this).css("width"),height:$(this).css("height"),opacity:"0"});var g=100<parseInt($(this).css("width"),10)||100<parseInt($(this).css("height"),10)?$(this).children(".draggable").attr("delay_src_h"):$(this).children(".draggable").attr("src"),b=$(this);if(0<=$(this).children(".draggable").attr("class").indexOf("cached")){var j=new Image;"undefined"!=typeof b.children(".draggable").data("zdx")?(g=$("<canvas>"),g[0].width=parseInt(b.css("width"),10)+parseInt(b.css("border-left-width"),
10),g[0].height=parseInt(b.css("height"),10)+parseInt(b.css("border-left-width"),10),autoClipper2(b.children(".draggable")[0],g,b.children(".draggable").data("corner"),b),j.src=g[0].toDataURL(),j.width=g[0].width,j.height=g[0].height):j.src=g;j.onload=function(){0<=b.attr("class").indexOf("layout_circle")?doClipping(doMasking(j,a,b,d,c),b,cirClipper):0<=b.attr("class").indexOf("layout_square")&&doClipping(doMasking(j,a,b,d,c),b,boxClipper);b.css("opacity","0");setDragObj(b);b.droppable("enable")}}else{var k=
"#000";"black"==PHONE_COLOR&&(k="#FFF");var l=(new Spinner({lines:13,length:7,width:4,radius:10,corners:1,rotate:0,color:k,speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2E9,top:"auto",left:"auto"})).spin($(this)[0]);$.getImageData({url:g,server:HOST_URL+"proxy/getImageData.php",success:function(a){b.children(".draggable").attr("src",a.src);b.children(".draggable").addClass("cached");autoCentered(b,a);l.stop();b.css("opacity","0");setDragObj(b);b.droppable("enable")},error:function(){l.stop();
b.droppable("enable")}})}}},out:function(){0<$(this).children(".draggable").length&&0<=$(this).children(".draggable").attr("class").indexOf("ui-draggable-dragging")&&$(this).addClass("removed")},over:function(){},deactivate:function(){}})}
function menuLoadPhone(a){var d=function(a){PHONE_NAME=a;show_price(a);$.cookie("phone_name",PHONE_NAME);$(".device").find(".hovered").toggleClass("hovered");$("#"+a).parent().toggleClass("hovered");"iphone5"===a?($("#menu_type").html("iPhone 5").fadeIn(300),$("#white.color_item").parent().show(),$("#black.color_item").parent().show(),$("#trans.color_item").parent().show()):"iphone4"===a?($("#menu_type").html("iPhone 4/4S").fadeIn(300),PHONE_COLOR="white",$.cookie("phone_color",PHONE_COLOR),$("#menu_color").html("\u767d\u8272").fadeIn(300),
$("#white.color_item").parent().show(),$("#black.color_item").parent().hide(),$("#trans.color_item").parent().hide()):"s3"===a?($("#menu_type").html("Galaxy S3").fadeIn(300),"black"==PHONE_COLOR&&(PHONE_COLOR="white",$.cookie("phone_color",PHONE_COLOR),$("#menu_color").html("\u767d\u8272").fadeIn(300)),$("#white.color_item").parent().show(),$("#black.color_item").parent().hide(),$("#trans.color_item").parent().show()):"onex"===a&&($("#menu_type").html("HTC One X").fadeIn(300),"black"==PHONE_COLOR&&
(PHONE_COLOR="white",$.cookie("phone_color",PHONE_COLOR),$("#menu_color").html("\u767d\u8272").fadeIn(300)),$("#white.color_item").parent().show(),$("#black.color_item").parent().hide(),$("#trans.color_item").parent().show());$(".color").find(".hovered").toggleClass("hovered");$("#"+PHONE_COLOR).parent().toggleClass("hovered");setCanvas(a)};0!=$(".canvas_appended").length?($("body").append('<div class="modalOverlay"></div>'),new Messi("\u60a8\u78ba\u5b9a\u8981\u5207\u63db\u624b\u6a5f\u55ce\uff1f\u6240\u6709\u7684\u5716\u7247\u5c07\u6703\u88ab\u6e05\u7a7a\uff01",
{title:"\u5207\u63db\u624b\u6a5f",buttons:[{id:0,label:"Yes",val:"Y"},{id:1,label:"No",val:"N"}],callback:function(c){$(".modalOverlay").remove();$(".layout_corner").animate({opacity:CORNER_OPT});"Y"===c&&($(".layout_corner").length&&$(".layout_corner").children(".draggable").each(function(){$(this).remove();$(this)[0]=null}),$(".canvas_appended").length&&$(".canvas_appended").each(function(){$(this).remove();$(this)[0]=null}),d(a))}})):d(a)}
function menuLoadColor(a){var d=function(a){PHONE_COLOR=a;$.cookie("phone_color",PHONE_COLOR);setCanvas(PHONE_NAME);$(".color").find(".hovered").toggleClass("hovered");$("#"+a).parent().toggleClass("hovered");"white"===a?$("#menu_color").html("\u767d\u8272").fadeIn(300):"black"===a?$("#menu_color").html("\u9ed1\u8272").fadeIn(300):"trans"===a&&$("#menu_color").html("\u900f\u660e").fadeIn(300)};0!=$(".canvas_appended").length?($("body").append('<div class="modalOverlay"></div>'),new Messi("\u60a8\u78ba\u5b9a\u8981\u5207\u63db\u80cc\u84cb\u984f\u8272\u55ce\uff1f\u6240\u6709\u7684\u5716\u7247\u5c07\u6703\u88ab\u6e05\u7a7a\uff01",
{title:"\u5207\u63db\u80cc\u84cb\u984f\u8272",buttons:[{id:0,label:"Yes",val:"Y"},{id:1,label:"No",val:"N"}],callback:function(c){$(".modalOverlay").remove();$(".layout_corner").animate({opacity:CORNER_OPT});"Y"===c&&($(".layout_corner").length&&$(".layout_corner").children(".draggable").each(function(){$(this).remove();$(this)[0]=null}),$(".canvas_appended").length&&$(".canvas_appended").each(function(){$(this).remove();$(this)[0]=null}),d(a))}})):d(a)}
function menuLoadLayout(a){var d=function(a){LAYOUT_NAME=a;$.cookie("layout_name",LAYOUT_NAME);loadLayout(maskImg,layout_ox,layout_oy,PHONE_NAME+"_"+LAYOUT_NAME);$("#menu_layout").html(a.replace("_"," ")).fadeIn(300);$(".layout").find(".hovered").toggleClass("hovered");$("#"+a).toggleClass("hovered")};0!=$(".canvas_appended").length?($("body").append('<div class="modalOverlay"></div>'),new Messi("\u60a8\u78ba\u5b9a\u8981\u5207\u63db\u7248\u578b\u55ce\uff1f\u6240\u6709\u7684\u5716\u7247\u5c07\u6703\u88ab\u6e05\u7a7a\uff01",
{title:"\u5207\u63db\u7248\u578b",buttons:[{id:0,label:"Yes",val:"Y"},{id:1,label:"No",val:"N"}],callback:function(c){$(".modalOverlay").remove();$(".layout_corner").animate({opacity:CORNER_OPT});"Y"===c&&($(".layout_corner").length&&$(".layout_corner").children(".draggable").each(function(){$(this).remove();$(this)[0]=null}),$(".canvas_appended").length&&$(".canvas_appended").each(function(){$(this).remove();$(this)[0]=null}),d(a))}})):d(a)}
function loadLayout(a,d,c,f){$(".layout_corner").each(function(){$(this).remove();$(this)[0]=null});$(".canvas_appended").each(function(){$(this).remove();$(this)[0]=null});$(".warning").remove();$("link[type='text/css']#layout_css").remove();a=jQuery("<link>");a.attr({rel:"stylesheet",type:"text/css",href:"css/"+f+".css?v="+(new Date).getTime(),id:"layout_css"});$("head").append(a);styleOnload(a[0],function(){var a="js/"+f+".js?v="+(new Date).getTime();$.getScript(a).done(function(){setDnD(maskImg,
d,c);isMenuEntry=!1}).fail(function(){isMenuEntry=!1})})}function setContainer(){var a=$(window).height();$(document).height();$("#wrapper").css("height",a-$(".recent").height()+"px");1224>=$(document).width()?$(".mainmenu").css("width","1224px"):$(".mainmenu").css("width","100%")}function setFooterTop(){$("#tip1").css("left",Math.round(parseInt($("#popbox > .open").offset().left,10))-60);$("#tip3").css("left",Math.round(parseInt($("#popbox > .open").offset().left,10))-60)}
function setCanvas(a){0<$("#mCanvas").length&&($("#mCanvas").remove(),$("#mCanvas")[0]=null);$(".warning").remove();var d=document.createElement("Canvas");d.setAttribute("id","mCanvas");var c=d.getContext("2d");$(".mainmenu").before(d);$(window).height();$(window).width();layout_oy=66;layout_ox=404;$("#mCanvas").css("top",layout_oy+"px");$("#mCanvas").css("left",layout_ox+"px");$(".mTitle").fadeIn(3E3);var f=new Image;f.src="images/"+a+"_"+PHONE_COLOR+".png";f.onload=function(){$("#mCanvas")[0].width=
f.width;$("#mCanvas")[0].height=f.height;c.drawImage(f,0,0,f.width,f.height)};$.getImageData({url:HOST_URL+"images/"+a+"_mask.png",server:HOST_URL+"proxy/getImageData.php",success:function(a){maskImg=a;menuLoadLayout(LAYOUT_NAME);loadPriceTag(!0)},error:function(){}})}
function setAccordionMenu(){var a=$(".accordion > li > a"),d=$(".accordion li > .sub-menu");a.first().addClass("active").next().slideDown("normal");a.click(function(c){c.preventDefault();"active"!=$(this).attr("class")&&(d.slideUp("normal"),$(this).next().stop(!0,!0).slideToggle("normal"),a.removeClass("active"),$(this).addClass("active"))})}function saveImg(){mod_saving(function(){removeUnclearWarning("_big");releasePage("Design");newPage("Gallery")})}function randomDesign(){mod_randesign()}
function startDesign(){releasePage(PAGE);newPage("Design")}
function openGallery(){"Checkout"==PAGE?($("body").append('<div class="modalOverlay"></div>'),new Messi("\u60a8\u5c1a\u672a\u5b8c\u6210\u4ed8\u6b3e\u5594!\u78ba\u5b9a\u8981\u53d6\u6d88\u55ce\uff1f",{title:"\u53d6\u6d88\u4ed8\u6b3e",buttons:[{id:0,label:"Yes",val:"Y"},{id:1,label:"No",val:"N"}],callback:function(a){"Y"===a&&(releasePage(PAGE),newPage("Gallery"));$(".modalOverlay").remove()}})):"Design"==PAGE&&0!=$(".canvas_appended").length?($("body").append('<div class="modalOverlay"></div>'),new Messi("\u60a8\u78ba\u5b9a\u8981\u96e2\u958b\u8a2d\u8a08\u9801\u9762\u55ce\uff1f\u6240\u6709\u7684\u5716\u7247\u5c07\u6703\u88ab\u6e05\u7a7a\uff01",
{title:"\u96e2\u958b\u8a2d\u8a08\u9801\u9762",buttons:[{id:0,label:"Yes",val:"Y"},{id:1,label:"No",val:"N"}],callback:function(a){"Y"===a&&(removeUnclearWarning("_big"),releasePage(PAGE),newPage("Gallery"));$(".modalOverlay").remove()}})):(releasePage(PAGE),newPage("Gallery"))}
function newPage(a){PAGE=a;"Design"==a?($("#menubar").fadeIn(300),$(".recent").fadeIn(300),$("#random-design").fadeIn(300),$("#clear-design").fadeIn(300),$("#save-design").fadeIn(300),setCanvas(PHONE_NAME),"facebook"==source_type?_fbCrossLogin(access_token):"instagram"==source_type&&_instaCrossLogin(access_token),$("#mTitle").html(TITLE_NAME),$("#mTitle").editable(function(a){return TITLE_NAME=$.trim(a)},{onblur:"submit",placeholder:"\u672a\u547d\u540d",tooltip:"\u8acb\u8f38\u5165\u540d\u7a31",style:"display: inline"})):
"Save"==a?($("#start-design").fadeIn(300),$("#my-gallery").fadeIn(300)):"Gallery"==a?($("#start-design").fadeIn(300),mod_gallery()):"Checkout"==a?mod_checkout():"Order_History"==a&&mode_history()}
function releasePage(a){"Design"==a?($("#random-design").hide(),$("#clear-design").hide(),$("#save-design").hide(),$("#menubar").hide(),$("#mCanvas").remove(),$("#mCanvas")[0]=null,$("#mTitle").html(""),$(".warning").remove(),$(".recent").find(".draggable").each(function(){$(this).remove();$(this)[0]=null}),$(".recent").hide(),$(".ad-preloads").remove(),$(".ad-preloads")[0]=null,loadPriceTag(!1),$(".layout_corner").length&&($(".layout_corner").children(".draggable").each(function(){$(this).remove();
$(this)[0]=null}),$(".layout_corner").each(function(){$(this).remove();$(this)[0]=null})),$(".canvas_appended").length&&$(".canvas_appended").each(function(){$(this).remove();$(this)[0]=null}),$("#galleryCanvas").length&&($("#galleryCanvas").remove(),$("#galleryCanvas")[0]=null)):"Save"==a?($("#start-design").hide(),$("#my-gallery").hide(),$("#galleryCanvas").remove(),$("#galleryCanvas")[0]=null):"Gallery"==a?($("#start-design").hide(),$("#gallery").remove(),$("#gallery")[0]=null,$(".shopping_cart").remove(),
$(".shopping_cart")[0]=null,$(".shopping_cart2").remove(),$(".shopping_cart2")[0]=null):"Checkout"==a&&$(".order").remove()}function loadPriceTag(a){!0==a?($("#price_tag").show(),$("#price_tag").css("left",370+layout_ox+"px"),$("#price_tag").css("top",80+layout_oy+"px")):$("#price_tag").hide()}
$(function(){-1!=navigator.userAgent.indexOf("Firefox")&&$("body").css("overflow","auto");$("body").iealert({support:"ie8",title:"\u60a8\u7684\u700f\u89bd\u5668\u7248\u672c\u592a\u8001\u820a\u4e86!",text:'\u70ba\u4e86\u66f4\u597d\u3001\u66f4\u5b89\u5168\u7684\u4f7f\u7528\u9ad4\u9a57 <br>\u8acb<font color="red">\u7acb\u5373\u66f4\u65b0</font>\u60a8\u7684\u700f\u89bd\u5668\u5427\u3002',upgradeTitle:"\u7acb\u5373\u66f4\u65b0"});setAccordionMenu();setContainer();setFooterTop();$.cookie("phone_name")&&
(PHONE_NAME=$.cookie("phone_name"));$.cookie("phone_color")&&(PHONE_COLOR=$.cookie("phone_color"),"white"===PHONE_COLOR?$("#menu_color").html("\u767d\u8272").fadeIn(300):"black"===PHONE_COLOR?$("#menu_color").html("\u9ed1\u8272").fadeIn(300):"trans"===PHONE_COLOR&&$("#menu_color").html("\u900f\u660e").fadeIn(300));$.cookie("layout_name")&&(LAYOUT_NAME=$.cookie("layout_name"));menuLoadPhone(PHONE_NAME);simpleCart({cartColumns:[{view:function(a){return a.get("name")},attr:"name",label:"\u540d\u7a31"},
{attr:"price",label:"\u50f9\u683c",view:"currency"},{attr:"title",label:"Title"},{attr:"image",label:"Image"},{view:"decrement",label:!1,text:"-"},{view:function(a){return a.quantity()},attr:"quantity",label:"\u6578\u91cf"},{view:"increment",label:!1,text:"+"},{view:function(a){return simpleCart.toCurrency(a.get("total"))},attr:"total",label:"\u5c0f\u8a08"},{view:"remove",text:"\u5168\u90e8\u6e05\u9664",label:!1}]});$("#mTitle").editable(function(a){return TITLE_NAME=$.trim(a)},{onblur:"submit",placeholder:"\u672a\u547d\u540d",
tooltip:"\u8acb\u8f38\u5165\u540d\u7a31",style:"display: inline"});$.instagramr();$("#start-design").hide();$("#my-gallery").hide();$("#popbox").popbox()});$(window).resize(function(){setContainer();setFooterTop()});$(window).scroll(function(){setFooterTop()});window.console||(window.console={});window.console.log||(window.console.log=function(){});