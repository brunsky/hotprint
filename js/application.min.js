
var SANDBOX=false;var HOST_URL='';if(SANDBOX)
HOST_URL='http://sandbox.hotprintcloud.com/';else
HOST_URL='http://www.hotprintcloud.com/';var TEMP_DIR='proxy/tmp/'
var PHONE_NAME='iphone5';var LAYOUT_NAME='layout_3';var PHONE_COLOR='white';var layout_ox=410;var layout_oy=Math.floor($(window).height()*0.1);var CORNER_OPT=0.1;var isCornerFading=false;var PAGE='Design';var TITLE_NAME='';var maskImg;var _init,_getUserData,_displayUserData,_instaCrossLogin,_instalogin,_instalogout,_getUserRecent,_facebookPhotoAlbum,_fblogin,_fbCrossLogin,_fblogout,_logout,_loadLayout;var access_token,user_id,source_type;(function(){$.extend({instagramr:function(){_init();}});_init=function(){$('html').removeClass('no-js');$('body').addClass('not-logged-in');$('#login').click({isPopup:false},_instalogin);$('#login2').click({isPopup:false},_fblogin);$('#facebook-source-login').click({isPopup:true},_fblogin);$('#instagram-source-login').click({isPopup:true},_instalogin);$('.layout_item').each(function(index){$(this).click({param:$(this).attr('id')},_loadLayout);});$('.phone_item').each(function(index){$(this).click({param:$(this).attr('id')},_loadPhone);});$('.color_item').each(function(index){$(this).click({param:$(this).attr('id')},_loadColor);});if(location.hash!=''){var token_item=location.hash.split('&')[0];var source_item=location.hash.split('&')[1];var b_feedback=location.hash.split('&')[2];if(source_item){if(source_item.split('=')[1]=='instagram')
_instaCrossLogin(token_item.split('=')[1]);else if(source_item.split('=')[1]=='facebook')
_fbCrossLogin(token_item.split('=')[1]);else{$.removeCookie('source');$.removeCookie('access_token');parent.location.hash='';return;}
parent.location.hash='';$.cookie('access_token',token_item.split('=')[1]);if(b_feedback&&b_feedback.split('=')[0]=='b'){$("body").append('<div class="modalOverlay"></div>');if(b_feedback.split('=')[1]=='succeed'){new Messi('您已經付款成功! 可以隨時檢視出貨進度<br>或者繼續設計新的作品。',{title:'恭喜!',buttons:[{id:0,label:'Close',val:'C'}],callback:function(val,content){$('.modalOverlay').remove();simpleCart.empty();}});}
else{new Messi('剛剛的付款並未成功，您的信用卡沒有產生任何扣款記錄<br><br>請確認付款流程是否有誤，或稍後再試。',{title:'付款失敗',buttons:[{id:0,label:'Close',val:'C'}],callback:function(val,content){$('.modalOverlay').remove();}});}}}
else{$.removeCookie('source');$.removeCookie('access_token');}}
else{if($.cookie('access_token')&&$.cookie('source')){if($.cookie('source')=='instagram')
_instaCrossLogin($.cookie('access_token'));else if($.cookie('source')=='facebook')
_fbCrossLogin($.cookie('access_token'));else{$.removeCookie('source');$.removeCookie('access_token');parent.location.hash='';return;}}}};function _loadLayout(event){menuLoadLayout(event.data.param);}
function _loadPhone(event){menuLoadPhone(event.data.param);}
function _loadColor(event){menuLoadColor(event.data.param);}
function bindFunc(){$('#save-design').unbind('click');$('#random-design').unbind('click');$('#clear-design').unbind('click');$('#start-design').unbind('click');$('#my-gallery').unbind('click');$('#logout').unbind('click');$('#go-to-my-gallery').unbind('click');$('#save-design').bind('click',saveImg);$('#random-design').bind('click',randomDesign);$('#clear-design').bind('click',clearDesign);$('#start-design').bind('click',startDesign);$('#my-gallery').bind('click',openGallery);$('#logout').bind('click',_logout);$('#go-to-my-gallery').bind('click',openGallery);}
_logout=function(){$("body").append('<div class="modalOverlay"></div>');$.removeCookie('source');$.removeCookie('access_token');$.removeCookie('user_id');$.removeCookie('phone_name');$.removeCookie('layout_name');$.removeCookie('phone_color');_fblogout(_instalogout);}
var instaRes;_instalogin=function(event){var url='https://instagram.com/oauth/authorize/?'+'client_id=c4b0c9a61cc24efbb4cd5feb71be67b8'+'&amp;redirect_uri='+HOST_URL+'instaredirect.html'+'&amp;response_type=token';if(event.data.isPopup==true){window.open(url,'hotprintCloud','height=400,width=600,left=10,top=10,resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no,directories=no,status=yes');return false;}
else
window.location=url;};_instalogout=function(callback){$.ajax({url:'https://instagram.com/accounts/logout/',dataType:'jsonp',error:function(xhr){location.reload();},success:function(response){location.reload();}});}
_instaCrossLogin=function(token){access_token=token;source_type="instagram";if($.cookie('source')==null)
$.cookie('source',source_type);$('body').addClass('logged-in');_getUserData();bindFunc();};_getUserData=function(){var request=$.ajax({dataType:"jsonp",url:"https://api.instagram.com/v1/users/self",data:{access_token:access_token}});request.success(_displayUserData);};_displayUserData=function(json){if(json.meta.code!='200'){$.removeCookie('source');$.removeCookie('access_token');$('body').removeClass('logged-in');$('body').addClass('not-logged-in');return;}
user_id=json.data.id;if($.cookie('source')=='instagram'){$.cookie('user_id',user_id);$.cookie('user_type','instagram');$(".open").html("").fadeIn(300).append(json.data.username);}
instaRes='';_getUserRecent();};_getUserRecent=function(next_url){if($('#fbalbums').length>0)
$('#fbalbums').attr('disabled','disabled');var url;if(next_url!=null)
url=next_url;else
url="https://api.instagram.com/v1/users/"+user_id+"/media/recent";var request=$.ajax({dataType:"jsonp",url:url,data:{access_token:access_token,count:100}});request.success(_displayUserRecent);};_displayUserRecent=function(json){for(var i=0;i<json.data.length;i++){instaRes+="<li><a><img src=\""+json.data[i].images.standard_resolution.url+"\" id='recent_instaimg"+i+"' class='draggable draggable-h draggable-w gallery-pool' /></a></li>";}
if(typeof json.pagination.next_url!='undefined')
_getUserRecent(json.pagination.next_url);else
gallery_bar_setting(instaRes);};var fbRes;_fblogin=function(event){var url='http://www.facebook.com/dialog/oauth/?'+'client_id=290426614419964'+'&redirect_uri='+HOST_URL+'fbredirect.html'+'&response_type=token'+'&scope=user_photos';if(event.data.isPopup==true){window.open(url,'hotprintCloud','height=600,width=800,left=10,top=10,resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no,directories=no,status=yes');return false;}
else
window.location=url;}
_fbCrossLogin=function(token){$('#facebook-source').html('');access_token=token;source_type="facebook";if($.cookie('source')==null)
$.cookie('source',source_type);$('body').addClass('logged-in');bindFunc();FB.api('/me?access_token='+access_token+'&fields=albums,id,name',function(response){if(!response||response.error){$.removeCookie('source');$.removeCookie('access_token');$('body').removeClass('logged-in');$('body').addClass('not-logged-in');return;}
user_id=response.id;if($.cookie('source')=='facebook'){$.cookie('user_id',user_id);$.cookie('user_type','facebook');$(".open").html("").fadeIn(300).append(response.name);}
$select=$('<select></select>');$select.attr('id','fbalbums');$.each(response.albums.data,function(key,value){$select.append($("<option></option>").attr("value",value.id).text(value.name));});$('#facebook-source').append($select);$select.change(function(){$('.recent').find('.draggable').each(function(index){$(this).remove();$(this)[0]=null;});fbRes='';_facebookPhotoAlbum();});fbRes='';_facebookPhotoAlbum();});}
_fblogout=function(callback){FB.getLoginStatus(function(response){if(response.status==='connected'){FB.logout(function(response){if(typeof callback!='undefined')
callback();});}
else{if(typeof callback!='undefined')
callback();}});}
_facebookPhotoAlbum=function(next_url){var settings=$.extend({'facebookAlbumId':$('#fbalbums :selected').val(),'photoLimit':'500','randomOrder':'false'});var albumId=settings.facebookAlbumId;var photoLimit=settings.photoLimit;var randomOrder=settings.randomOrder;var url;if(next_url!=null)
url=next_url+"&callback=?";else
url="https://graph.facebook.com/"+albumId+"/photos?access_token="+access_token+"&limit=0&callback=?";$.getJSON(url,function success(result){if($('#fbalbums').length>0)
$('#fbalbums').attr('disabled',false);var limit=photoLimit;if(result.data.length<limit){limit=result.data.length;}
for(i=0;i<limit;i++)
{var image=result.data[i];if(image.width>image.height)
fbRes+="<li><a><img src=\""+image.source+"\" id='recent_fbimg"+albumId+i+"' class='draggable draggable-h gallery-pool'/></a></li>";else
fbRes+="<li><a><img src=\""+image.source+"\" id='recent_fbimg"+albumId+i+"' class='draggable draggable-w gallery-pool'/></a></li>";}
if(typeof result.paging!='undefined'){if(typeof result.paging.next!='undefined')
_facebookPhotoAlbum(result.paging.next);else
gallery_bar_setting(fbRes);}
else
gallery_bar_setting(fbRes);});};})(jQuery);function show_price(phone_type){$.post('db/bom.php',{"part_name":phone_type},function(data){if(data.result=="ok"){$("#price_no").html(data.value);}},"json");}
function gallery_bar_setting(res){$(".ad-thumb-list").html("").fadeIn(300).append(res);$('.ad-gallery').adGallery({thumb_opacity:1});$('.ad-gallery').css('width',($(window).width()-50)+'px');$('.ad-gallery').css({"margin":'0 auto',"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"});if(!$.browser.msie){$('.gallery-pool').hover(function(){$(this).css('opacity',0);var $c=$(this).clone();$c.css({"left":$(this).position().left,"top":$(this).position().top,"width":$(this).css('width'),"height":$(this).css('height'),"position":"absolute","opacity":1,"box-shadow":"3px 3px 4px black","pointer-events":"none"});$(this).after($c);$c.animate({top:'-=20',left:'-=5',width:'+=10',height:'+=10'},'fast');},function(){$(this).css('opacity',1);$(this).next().remove();});}
$('.gallery-pool').draggable({scroll:false,cursor:'move',helper:"clone",cursorAt:{left:35,top:35},revert:"invalid",drag:function(event,ui){ui.helper.css('z-index','1000');ui.helper.css('opacity','0.7');if($(this).attr("class").indexOf("ui-draggable-dragging")>=0){$(".ui-draggable-dragging").css('z-index','1000');}
ui.helper.height($(this).data('oh'));ui.helper.width($(this).data('ow'));},start:function(event,ui){disable_scroll();$('.layout_corner').css('z-index','998');$('.layout_corner').stop(true,true).animate({opacity:1});$(this).data('oh',Math.round($(this).height()*0.7));$(this).data('ow',Math.round($(this).width()*0.7));},stop:function(event,ui){enable_scroll();isCornerFading=true;$('.layout_corner').animate({opacity:CORNER_OPT},{complete:function(){$('.layout_corner > .draggable').parent().css('opacity','0');isCornerFading=false;}});}});}
function clearCorner(pObj){if(typeof pObj.attr('class')=='undefined')
return;if(pObj.attr('class').indexOf('layout_corner')>=0){pObj.children(".draggable").each(function(index){$(this).remove();$(this)[0]=null;});pObj.css('cursor','default');if(pObj.next().attr('class')=='canvas_appended')
if(pObj.next()[0].tagName.toLowerCase()=='canvas'.toLowerCase()){pObj.next().remove();pObj.next()[0]=null;}
pObj.removeClass("removed");pObj.css('z-index','998');$('.layout_corner').animate({opacity:CORNER_OPT},{complete:function(){$('.layout_corner > .draggable').parent().css('opacity','0');}});}}
function setDnD(maskImg,ox,oy){var _copyData=function(toObj,fromObj){toObj.data('zdx',fromObj.data('zdx'));toObj.data('zdy',fromObj.data('zdy'));toObj.data('zw',fromObj.data('zw'));toObj.data('zh',fromObj.data('zh'));toObj.data('corner',fromObj.data('corner'));if(typeof toObj.attr('src')!='undefined'&&(toObj.attr('src').indexOf('http://')>=0||toObj.attr('src').indexOf('https://')>=0)){var str=HOST_URL+TEMP_DIR+toObj.attr('src').replace(/\//g,"+");toObj.data('src',str);}
else{toObj.data('src',fromObj.data('src'));}
toObj.data('oh',fromObj.data('oh'));toObj.data('ow',fromObj.data('ow'));}
$(".layout_corner").droppable({accept:".draggable",tolerance:"pointer",drop:function(event,ui){if(typeof $(ui.draggable).parent().attr('id')=='undefined'){return;}
if($(this).children(".spinner").length>0){return;}
$(this).droppable("disable");enable_scroll();if($(this).next()[0].tagName.toLowerCase()=='canvas'.toLowerCase()){$(this).next().remove();$(this).next()[0]=null;}
if($(ui.draggable).parent().attr('id')!=$(this).attr('id')){$(this).html('');$(this).append($(ui.draggable).clone());_copyData($(this).children(".draggable"),$(ui.draggable));clearCorner($(ui.draggable).parent());}
else{var $_tmpObj=$('<img>');_copyData($_tmpObj,$(ui.draggable));$(this).html('');$(this).append($(ui.draggable).clone());_copyData($(this).children(".draggable"),$_tmpObj);}
$(this).children(".draggable").removeClass("gallery-pool");if(isCornerFading==false){$('.layout_corner').animate({opacity:CORNER_OPT},{complete:function(){$('.layout_corner > .draggable').parent().css('opacity','0');}});}
$(this).children(".draggable").css({"position":"relative","top":"0px","left":"0px","width":$(this).css('width'),"height":$(this).css('height'),"opacity":"0"});var imgSrc=$(this).children(".draggable").attr('src');var divObj=$(this);if($(this).children(".draggable").attr("class").indexOf("cached")>=0){var _img=new Image();if(typeof divObj.children(".draggable").data('zdx')!='undefined'){var $dstCanvas=$('<canvas>');$dstCanvas[0].width=parseInt(divObj.css('width'),10)+parseInt(divObj.css('border-left-width'),10);$dstCanvas[0].height=parseInt(divObj.css('height'),10)+parseInt(divObj.css('border-left-width'),10);autoClipper2(divObj.children(".draggable")[0],$dstCanvas,divObj.children(".draggable").data('corner'),divObj);_img.src=$dstCanvas[0].toDataURL();_img.width=$dstCanvas[0].width;_img.height=$dstCanvas[0].height;}
else{_img.src=imgSrc;}
_img.onload=function(){if(divObj.attr("class").indexOf("layout_circle")>=0){doClipping(doMasking(_img,maskImg,divObj,ox,oy),divObj,cirClipper);}
else if(divObj.attr("class").indexOf("layout_square")>=0){doClipping(doMasking(_img,maskImg,divObj,ox,oy),divObj,boxClipper);}
divObj.css('opacity','0');setDragObj(divObj);divObj.droppable("enable");}}
else{var opts={lines:13,length:7,width:4,radius:10,corners:1,rotate:0,color:'#000',speed:1,trail:60,shadow:false,hwaccel:false,className:'spinner',zIndex:2e9,top:'auto',left:'auto'};var spinner=new Spinner(opts).spin($(this)[0]);$.getImageData({url:imgSrc,server:HOST_URL+"proxy/getImageData.php",success:function(image){divObj.children(".draggable").attr('src',image.src);divObj.children(".draggable").addClass("cached");if(divObj.attr("class").indexOf("layout_circle")>=0){doClipping(doMasking(image,maskImg,divObj,ox,oy),divObj,cirClipper);}
else if(divObj.attr("class").indexOf("layout_square")>=0){doClipping(doMasking(image,maskImg,divObj,ox,oy),divObj,boxClipper);}
spinner.stop();divObj.css('opacity','0');setDragObj(divObj);divObj.droppable("enable");},error:function(xhr,text_status){spinner.stop();divObj.droppable("enable");}});}},out:function(event,ui){if($(this).children(".draggable").length>0){if($(this).children(".draggable").attr("class").indexOf("ui-draggable-dragging")>=0)
$(this).addClass("removed");}},over:function(event,ui){},deactivate:function(event,ui){}});}
function menuLoadPhone(_phoneName){var change_phone=function(_phoneName){PHONE_NAME=_phoneName;show_price(_phoneName);$.cookie('phone_name',PHONE_NAME);$('.device').find('.hovered').toggleClass('hovered');$('#'+_phoneName).parent().toggleClass('hovered');if(_phoneName==='iphone5'){$('#menu_type').html('iPhone 5').fadeIn(300);$('#white.color_item').parent().show();$('#black.color_item').parent().show();$('#trans.color_item').parent().show();}
else if(_phoneName==='iphone4'){$('#menu_type').html('iPhone 4/4S').fadeIn(300);PHONE_COLOR='white';$.cookie('phone_color',PHONE_COLOR);$('#menu_color').html('白色').fadeIn(300);$('#white.color_item').parent().show();$('#black.color_item').parent().hide();$('#trans.color_item').parent().hide();}
else if(_phoneName==='s3'){$('#menu_type').html('Galaxy S3').fadeIn(300);if(PHONE_COLOR=='black'){PHONE_COLOR='white';$.cookie('phone_color',PHONE_COLOR);$('#menu_color').html('白色').fadeIn(300);}
$('#white.color_item').parent().show();$('#black.color_item').parent().hide();$('#trans.color_item').parent().show();}
else if(_phoneName==='onex'){$('#menu_type').html('HTC One X').fadeIn(300);if(PHONE_COLOR=='black'){PHONE_COLOR='white';$.cookie('phone_color',PHONE_COLOR);$('#menu_color').html('白色').fadeIn(300);}
$('#white.color_item').parent().show();$('#black.color_item').parent().hide();$('#trans.color_item').parent().show();}
$('.color').find('.hovered').toggleClass('hovered');$('#'+PHONE_COLOR).parent().toggleClass('hovered');setCanvas(_phoneName);}
if($('.canvas_appended').length!=0){$("body").append('<div class="modalOverlay"></div>');new Messi('您確定要切換手機嗎？所有的圖片將會被清空！',{title:'切換手機',buttons:[{id:0,label:'Yes',val:'Y'},{id:1,label:'No',val:'N'}],callback:function(val){$('.modalOverlay').remove();$('.layout_corner').animate({opacity:CORNER_OPT});if(val==='Y'){if($('.layout_corner').length){$('.layout_corner').children('.draggable').each(function(index){$(this).remove();$(this)[0]=null;});}
if($('.canvas_appended').length){$('.canvas_appended').each(function(index){$(this).remove();$(this)[0]=null;});}
change_phone(_phoneName);}}});}
else
change_phone(_phoneName);}
function menuLoadColor(_phoneColor){var change_color=function(_phoneColor){PHONE_COLOR=_phoneColor;$.cookie('phone_color',PHONE_COLOR);setCanvas(PHONE_NAME);$('.color').find('.hovered').toggleClass('hovered');$('#'+_phoneColor).parent().toggleClass('hovered');if(_phoneColor==='white'){$('#menu_color').html('白色').fadeIn(300);}
else if(_phoneColor==='black'){$('#menu_color').html('黑色').fadeIn(300);}
else if(_phoneColor==='trans'){$('#menu_color').html('透明').fadeIn(300);}}
if($('.canvas_appended').length!=0){$("body").append('<div class="modalOverlay"></div>');new Messi('您確定要切換背蓋顏色嗎？所有的圖片將會被清空！',{title:'切換背蓋顏色',buttons:[{id:0,label:'Yes',val:'Y'},{id:1,label:'No',val:'N'}],callback:function(val){$('.modalOverlay').remove();$('.layout_corner').animate({opacity:CORNER_OPT});if(val==='Y'){if($('.layout_corner').length){$('.layout_corner').children('.draggable').each(function(index){$(this).remove();$(this)[0]=null;});}
if($('.canvas_appended').length){$('.canvas_appended').each(function(index){$(this).remove();$(this)[0]=null;});}
change_color(_phoneColor);}}});}
else
change_color(_phoneColor);}
function menuLoadLayout(_layoutName){var change_layout=function(_layoutName){LAYOUT_NAME=_layoutName;$.cookie('layout_name',LAYOUT_NAME)
loadLayout(maskImg,layout_ox,layout_oy,PHONE_NAME+'_'+LAYOUT_NAME);$('#menu_layout').html(_layoutName.replace('_',' ')).fadeIn(300);$('.layout').find('.hovered').toggleClass('hovered');$('#'+_layoutName).toggleClass('hovered');}
if($('.canvas_appended').length!=0){$("body").append('<div class="modalOverlay"></div>');new Messi('您確定要切換版型嗎？所有的圖片將會被清空！',{title:'切換版型',buttons:[{id:0,label:'Yes',val:'Y'},{id:1,label:'No',val:'N'}],callback:function(val){$('.modalOverlay').remove();$('.layout_corner').animate({opacity:CORNER_OPT});if(val==='Y'){if($('.layout_corner').length){$('.layout_corner').children('.draggable').each(function(index){$(this).remove();$(this)[0]=null;});}
if($('.canvas_appended').length){$('.canvas_appended').each(function(index){$(this).remove();$(this)[0]=null;});}
change_layout(_layoutName);}}});}
else
change_layout(_layoutName);}
function loadLayout(_maskImg,ox,oy,_layoutName){$('.layout_corner').each(function(index){$(this).remove();$(this)[0]=null;});$('.canvas_appended').each(function(index){$(this).remove();$(this)[0]=null;});$("link[type='text/css']#layout_css").remove();var cssFile=jQuery("<link>");cssFile.attr({rel:"stylesheet",type:"text/css",href:"css/"+_layoutName+".css?v="+(new Date()).getTime(),id:"layout_css"});$("head").append(cssFile);styleOnload(cssFile[0],function(){var layoutLocation="js/"+_layoutName+".js?v="+(new Date()).getTime();$.getScript(layoutLocation).done(function(data,textStatus,jqxhr){setDnD(maskImg,ox,oy);}).fail(function(data,textStatus,jqxhr){});});}
function setContainer(){var winH=$(window).height();var docH=$(document).height();$('#wrapper').css('height',winH-$('.recent').height()+'px');if($(document).width()<=1224)
$(".mainmenu").css('width','1224px');else
$(".mainmenu").css('width','100%');}
function setFooterTop(){$('#tip1').css('left',Math.round(parseInt($('#popbox > .open').offset().left,10))-60);$('#tip3').css('left',Math.round(parseInt($('#popbox > .open').offset().left,10))-60);}
function setCanvas(_phoneName){if($('#mCanvas').length>0){$('#mCanvas').remove();$('#mCanvas')[0];}
var canvas=document.createElement('Canvas');canvas.setAttribute('id','mCanvas');var context=canvas.getContext('2d');$('.mainmenu').before(canvas);var winH=$(window).height();var winW=$(window).width();layout_oy=66;layout_ox=404;$("#mCanvas").css('top',layout_oy+'px');$("#mCanvas").css('left',layout_ox+'px');$('.mTitle').fadeIn(3000);var a=new Image();a.src="images/"+_phoneName+"_"+PHONE_COLOR+".png";a.onload=function(){$("#mCanvas")[0].width=a.width;$("#mCanvas")[0].height=a.height;context.drawImage(a,0,0,a.width,a.height);};$.getImageData({url:HOST_URL+"images/"+_phoneName+"_mask.png",server:HOST_URL+"proxy/getImageData.php",success:function(image){maskImg=image;menuLoadLayout(LAYOUT_NAME);loadPriceTag(true);},error:function(xhr,text_status){}});}
function setAccordionMenu(){var accordion_head=$('.accordion > li > a'),accordion_body=$('.accordion li > .sub-menu');accordion_head.first().addClass('active').next().slideDown('normal');accordion_head.click(function(event){event.preventDefault();if($(this).attr('class')!='active'){accordion_body.slideUp('normal');$(this).next().stop(true,true).slideToggle('normal');accordion_head.removeClass('active');$(this).addClass('active');}});}
function saveImg(){mod_saving(function(){releasePage('Design');newPage('Save');});}
function randomDesign(){mod_randesign();}
function startDesign(){releasePage(PAGE);newPage('Design');}
function openGallery(){if(PAGE=='Checkout'){$("body").append('<div class="modalOverlay"></div>');new Messi('您尚未完成付款喔!確定要取消嗎？',{title:'Alert',buttons:[{id:0,label:'Yes',val:'Y'},{id:1,label:'No',val:'N'}],callback:function(val,content){if(val==='Y'){releasePage(PAGE);newPage('Gallery');}
$('.modalOverlay').remove();}});}
else if(PAGE=='Design'&&$('.canvas_appended').length!=0){$("body").append('<div class="modalOverlay"></div>');new Messi('您確定要離開設計頁面嗎？所有的圖片將會被清空！',{title:'Alert',buttons:[{id:0,label:'Yes',val:'Y'},{id:1,label:'No',val:'N'}],callback:function(val,content){if(val==='Y'){releasePage(PAGE);newPage('Gallery');}
$('.modalOverlay').remove();}});}
else{releasePage(PAGE);newPage('Gallery');}}
function newPage(page){PAGE=page;if(page=="Design"){$('#menubar').fadeIn(300);$('.recent').fadeIn(300);$('#random-design').fadeIn(300);$('#clear-design').fadeIn(300);$('#save-design').fadeIn(300);setCanvas(PHONE_NAME);if(source_type=='facebook'){_fbCrossLogin(access_token);}
else if(source_type=='instagram'){_instaCrossLogin(access_token);}
$('#mTitle').html(TITLE_NAME);$('#mTitle').editable(function(value,settings){TITLE_NAME=$.trim(value);return(TITLE_NAME);},{onblur:"submit",placeholder:"未命名",tooltip:"請輸入名稱",});}
else if(page=="Save"){$('#start-design').fadeIn(300);$('#my-gallery').fadeIn(300);}
else if(page=="Gallery"){$('#start-design').fadeIn(300);mod_gallery();}
else if(page=="Checkout"){mod_checkout();}
else if(page=="Order_History"){}}
function releasePage(page){if(page=="Design"){$('#random-design').hide();$('#clear-design').hide();$('#save-design').hide();$('#menubar').hide();$('#mCanvas').remove();$('#mCanvas')[0]=null;$('#mTitle').html('');$('.recent').find('.draggable').each(function(index){$(this).remove();$(this)[0]=null;});$('.recent').hide();$('.ad-preloads').remove();$('.ad-preloads')[0]=null;loadPriceTag(false);if($('.layout_corner').length){$('.layout_corner').children('.draggable').each(function(index){$(this).remove();$(this)[0]=null;});$('.layout_corner').each(function(index){$(this).remove();$(this)[0]=null;});}
if($('.canvas_appended').length){$('.canvas_appended').each(function(index){$(this).remove();$(this)[0]=null;});}}
else if(page=="Save"){$('#start-design').hide();$('#my-gallery').hide();$('#galleryCanvas').remove();$('#galleryCanvas')[0]=null;}
else if(page=="Gallery"){$('#start-design').hide();$('#gallery').remove();$('#gallery')[0]=null;$('.shopping_cart').remove();$('.shopping_cart')[0]=null;}
else if(page=="Checkout"){$('.order').remove();}}
function loadPriceTag(isShow){if(isShow==true){$('#price_tag').show();$('#price_tag').css('left',370+layout_ox+'px');$('#price_tag').css('top',80+layout_oy+'px');}
else
$('#price_tag').hide();}
$(function(){if(navigator.userAgent.indexOf("Firefox")!=-1){$('body').css('overflow','auto');}
$("body").iealert({support:"ie8",title:"您的瀏覽器版本太老舊了!",text:"為了更好、更安全的使用體驗 <br>請<font color=\"red\">立即更新</font>您的瀏覽器吧。",upgradeTitle:"立即更新"});setAccordionMenu();setContainer();setFooterTop();if($.cookie('phone_name'))
PHONE_NAME=$.cookie('phone_name');if($.cookie('phone_color')){PHONE_COLOR=$.cookie('phone_color');if(PHONE_COLOR==='white'){$('#menu_color').html('白色').fadeIn(300);}
else if(PHONE_COLOR==='black'){$('#menu_color').html('黑色').fadeIn(300);}
else if(PHONE_COLOR==='trans'){$('#menu_color').html('透明').fadeIn(300);}}
if($.cookie('layout_name'))
LAYOUT_NAME=$.cookie('layout_name');menuLoadPhone(PHONE_NAME);simpleCart({cartColumns:[{view:function(item,column){return"<span>"+item.get('name')+"</span>"},attr:"name",label:"名稱"},{attr:"price",label:"價格",view:'currency'},{view:"decrement",label:false,text:"-"},{view:function(item,column){return"<span class='item_qty'>"+item.quantity()+"</span>"},attr:"quantity",label:"數量"},{view:"increment",label:false,text:"+"},{view:function(item,column){return"<span>"+simpleCart.toCurrency(item.get('total'))+"</span>"},attr:"total",label:"小計"},{view:"remove",text:"全部清除",label:false}]});$('#mTitle').editable(function(value,settings){TITLE_NAME=$.trim(value);return(TITLE_NAME);},{onblur:"submit",placeholder:"未命名",tooltip:"請輸入名稱",});$.instagramr();$('#start-design').hide();$('#my-gallery').hide();$('#popbox').popbox();});$(window).resize(function(){setContainer();setFooterTop()});$(window).scroll(function(){setFooterTop();});if(!window.console)window.console={};if(!window.console.log)window.console.log=function(){};