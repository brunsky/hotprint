function check_detail(a){$("#detail_"+a).toggle()}
function mode_history(){$.post("db/retrive_order.php",{userid:$.cookie("user_id")},function(a){var b=$.parseJSON(a);$("body").append('<div class="order_history" style="top:80px; left:20%; position:absolute" ><p align="center" style="font-size:20px;"><strong>'+$.i18n.prop("Msg_42")+'</strong></p><table width="800" border="0" align="center" cellpadding="0" cellspacing="0" id="table_sty"><tr><td width="28%" class="title">'+$.i18n.prop("Msg_43")+'</td><td width="27%" class="title">'+$.i18n.prop("Msg_44")+
'</td><td width="10%" class="title">'+$.i18n.prop("Msg_39")+'</td><td width="10%" class="title">'+$.i18n.prop("Msg_45")+'</td><td width="15%" class="title">'+$.i18n.prop("Msg_46")+'</td><td width="10%" class="title"> </td></tr></table></div>');$.each(b,function(a){for(var e=$.parseJSON(b[a].detail),f="",k=0,h=1;h<=e.itemCount;h++){var k=k+(parseInt(e["item_quantity_"+h])||0),g=e["item_options_"+h].split(",")[0].split(": ")[1],j=e["item_options_"+h].split(",")[1].split(": ")[1],f=f+('<img src="'+g+
'" width="40" height="68" align="absmiddle"/> '+j+", "+$.i18n.prop("Msg_48")+"\uff1a"+e["item_price_"+h]+" x"+e["item_quantity_"+h]+"</img>");0==h%4&&(f+="<br>")}$("#table_sty").append("<tr><td>"+b[a].order_no+"</td><td>"+b[a].c_time_local+"</td><td>"+k+"</td><td>"+b[a].payment+"</td><td>"+e.card_no.replace(/.(?=.{4})/g,"x")+'</td><td><a href="#" onClick="check_detail(\''+b[a].order_no+"')\">"+$.i18n.prop("Msg_47")+"</a></td></tr>");$("#table_sty").append('<tr id="detail_'+b[a].order_no+'" style="display: none"><td colspan="6" style="text-align: left"><br>'+
f+"<br><br> "+$.i18n.prop("Msg_49")+"\uff1a "+e.shipping_addr+","+e.shipping_city+","+e.shipping_country+"<br><br>"+$.i18n.prop("Msg_50")+"\uff1a "+e.shipping_name+"<br><br>email\uff1a "+e.shipping_email+"<br><br></td></tr>")});$("#table_sty").append('<tr><td height="38" class="title">&nbsp;</td><td class="title">&nbsp;</td><td class="title">&nbsp;</td><td class="title">&nbsp;</td><td class="title">&nbsp;</td><td class="title">&nbsp;</td></tr>')})}
function get_time(){var a=new Date,b=a.getDate(),c=a.getMonth()+1,e=a.getFullYear(),f=a.getHours(),k=a.getMinutes(),a=a.getSeconds();return e+"-"+c+"-"+b+" "+f+":"+k+":"+a}function switchNum(a){return a.replace(/(\d)(\d)(\d)(\d)/gi,"$3$4$1$2")}function checkValid(){var a=!0;$(".order :input").each(function(){""==$(this).val()&&"coupon_no"!=$(this).attr("id")&&($(this).after("<span class='fillcheck'><font color='red'>"+$.i18n.prop("Msg_51")+"<font></span>"),a=!1)});return a}
function autoComplete(){$(".order :input").each(function(){""==$(this).val()&&"coupon_no"!=$(this).attr("id")&&("card_no"==$(this).attr("id")?$(this).val("1111111111111111"):"expiry_date"==$(this).attr("id")?$(this).val("1223"):"cvc_no"==$(this).attr("id")&&$(this).val("111"))})}
function mod_checkout(){var a=0;$order=$("<div></div>");$order.addClass("order");$order.css("position","absolute");$order.css("top",$(".mainmenu").height()+50+"px");$order.load("checkout/checkout.html?v="+(new Date).getTime(),function(){dust.helpers.i18n=function(a,b,f,k){b=dust.helpers.tap(k.key,a,b);return a.write($.i18n.map[b])};var b=dust.compile($(this).html(),"checkout");dust.loadSource(b);dust.render("checkout",null,function(a,b){$order.html(b)});$("#checkout_cancel").val($.i18n.prop("Msg_90"));
$("#checkout_confirm").val($.i18n.prop("Msg_91"));simpleCart.update();$(".order a.preview").hover(function(a){var b=$(this).parent().offset();$(".order").append("<div id='cvc'><img src='checkout/card.png'/></div>");$("#cvc").css("position","absolute");$("#cvc").css("top",a.pageY-b.top+"px").css("left",a.pageX-b.left+"px").fadeIn("fast")},function(){$("#cvc").remove()});$(".order a.preview").mousemove(function(a){var b=$(this).parent().offset();$("#cvc").css("top",a.pageY-b.top+"px").css("left",a.pageX-
b.left+"px")});$("#checkout_cancel").click(function(){openGallery()});$("#checkout_confirm").click(function(){$(".fillcheck").remove();$("#checkout_confirm").val()==$.i18n.prop("Msg_91")&&""!=$("#coupon_no").val()?($("#couponcheck").remove(),$.post("checkout/coupon.php",{code:$("#coupon_no").val(),userid:$.cookie("user_id"),currency:simpleCart.currency().code},function(b){if("ok"==b.result){var e=parseFloat(simpleCart.grandTotal(),10).toFixed(2);a=b.value;0>=e-a?(a=e,$(".chk_hide").hide(),autoComplete(),
$("#coupon_no").hide(),$("#checkout_confirm").val($.i18n.prop("Msg_52"))):$("#checkout_confirm").val($.i18n.prop("Msg_57"));b=parseFloat(e-a).toFixed(2);$(".simpleCart_total").html("").fadeIn(300).append(DOLLAR_SIGN+b.toString());$("#coupon_no").after('<span id="couponcheck"><font color="red">'+$.i18n.prop("Msg_53")+" "+DOLLAR_SIGN+a+"</font></span>")}else"used"==b.value?$("#coupon_no").after('<span id="couponcheck"><font color="red">'+$.i18n.prop("Msg_54")+"</font></span>"):"invalid"==b.value?$("#coupon_no").after('<span id="couponcheck"><font color="red">'+
$.i18n.prop("Msg_55")+"</font></span>"):"due"==b.value?$("#coupon_no").after('<span id="couponcheck"><font color="red">'+$.i18n.prop("Msg_93")+"</font></span>"):$("#coupon_no").after('<span id="couponcheck"><font color="red">'+$.i18n.prop("Msg_56")+"</font></span>"),$("#coupon_no").val("")},"json")):!1!=checkValid()&&(simpleCart({checkout:{type:"SendForm",url:HOST_URL+"checkout/bill.php",success:"index.html?b=succeed",cancel:"index.html?b=cancel",extra_data:{storename:$(".open").html(),userid:$.cookie("user_id"),
token:$.cookie("access_token"),type:$.cookie("source"),card_no:$("#card_no").val(),expiry_date:switchNum($("#expiry_date").val()),cvc_no:$("#cvc_no").val(),coupon_no:$("#coupon_no").val(),total:simpleCart.grandTotal()-a,shipping_email:$("#shipping_email").val(),shipping_name:$("#shipping_name").val(),shipping_addr:$("#shipping_address").val(),shipping_city:$("#shipping_city").val(),shipping_country:$("#countrySelect :selected").text(),c_time:get_time(),lang:MY_LANG,currency:simpleCart.currency().code}}}),
simpleCart.checkout())})});$("body").append($order)}
function mod_gallery(){$g=$("<div></div>");$("body").append($g);$g.attr("id","gallery");$("#gallery").before('<div class="shopping_cart">'+$.i18n.prop("Msg_58")+'<div> ----------- </div><div class="simpleCart_items"></div><div style="float:left">'+$.i18n.prop("Msg_59")+'\uff1a</div><div class="simpleCart_total"></div></div>');$(".shopping_cart").css("top","100px");$(".shopping_cart").css("left","100px");$("#gallery").before('<div class="shopping_cart2" style="top:80px; left:25%; position:absolute" ><p align="center" style="font-size:20px;"><strong>'+$.i18n.prop("Msg_58")+
'</strong></p><table width="650" border="0" align="center" cellpadding="0" cellspacing="0" id="table_sty"></table></div>');simpleCart.bind("beforeAdd",function(a){if(a.fields().currency!=simpleCart.currency().code)return alert($.i18n.prop("Msg_92")),!1});simpleCart.bind("update",function(){$("#table_sty").html("");$("#table_sty").append('<tr><td width="5%" class="title">\u3000</td><td width="30%" class="title">'+$.i18n.prop("Msg_37")+'</td><td width="20%" class="title">'+$.i18n.prop("Msg_38")+'</td><td width="10%" class="title">'+
$.i18n.prop("Msg_39")+'</td><td width="20%" class="title">'+$.i18n.prop("Msg_40")+'</td><td width="15%" class="title">&nbsp;</td></tr>');$(".itemRow").each(function(){$("#table_sty").append('<tr><td><img src="'+$(this).children(".item-image").html()+'" width="40" height="68" /></td><td>'+$(this).children(".item-title").html()+"</td><td>"+$(this).children(".item-price").html()+"</td><td>"+$(this).children(".item-quantity").html()+"</td><td>"+$(this).children(".item-total").html()+'</td><td><img id="cart2_'+
$(this).attr("id")+'" style="cursor:pointer" src="css/images/delete.png" width="18" height="18" /></td></tr>');var a=$(this);$("#cart2_"+$(this).attr("id")).click(function(){a.find(".simpleCart_remove").click()})});$("#table_sty").append('<tr><td height="38" class="title">&nbsp;</td><td class="title">&nbsp;</td><td class="title">&nbsp;</td><td class="title">&nbsp;</td><td class="title">&nbsp;</td><td class="title">&nbsp;</td></tr>');$("#table_sty").append('<tr><td colspan="4" class="amount">'+$.i18n.prop("Msg_59")+
" "+$(".simpleCart_total").html()+'\u3000</td><td style="border-bottom: none;"><div class="checkout">'+$.i18n.prop("Msg_60")+"</div></td></tr>");$(".checkout").click(function(){releasePage("Gallery");newPage("Checkout")});$(".item-decrement").css("padding-right","12px");$(".item-quantity").css("padding-right","12px");$(".headerRow > .item-total").css("padding-left","100px");$("#gallery").css("top",Math.round(parseInt($(".shopping_cart2").css("top")))+$(".shopping_cart2").height()+50+"px");0==simpleCart.grandTotal()?
$(".checkout").hide():$(".checkout").show()});simpleCart.init();$.cookie("user_id")&&$.post("db/retrive_gallery.php",{userid:$.cookie("user_id")},function(a){$("#gallery").append('<p align="center" style="font-size:20px;"><strong>'+$.i18n.prop("Msg_61")+"</strong></p>");a=$.parseJSON(a);$.each(a,function(a,c){var e="",e="USD"==c.currency?"USD":"NTD"==c.currency?"NTD":"USD";$("#gallery").append('<div class="simpleCart_shelfItem"><div class="list_pic"><img src="'+c.orig_img+'" alt="image" width="120" height="202"/></div><span class="item_image" style="display:none">'+
c.orig_img+'</span><div class="list_txt"><p><strong class="item_title">'+c.title_name+'</strong><span class="item_name" style="display:none">'+c.s_name+"</span></p><p>"+c.phone_type+" / "+c.phone_color+'</p><p><span class="item_price">'+e+c.price+'</span></p><span class="item_currency" style="display:none">'+e+'</span><a class="item_add" href="javascript:;"><img src="css/images/add_shoppingcar.png" width="18" height="18" /></a></div>')})})}
function _send_factory(a){releasePage(PAGE);$.post("db/retrive_image_factory.php",{userid:$.cookie("user_id"),s_save:a},function(a){a=$.parseJSON(a);var c=$.parseJSON(a[0].saveimag);_producing_for_factory(c,a[0].phone_type)})}var scaling=3;
function mod_saving(a){function b(){var g=k.get(h++);if($(g).length)$status.css("width",function(){f+=e;return f+"%"}),c.push({cornerId:$(g).attr("id"),cornerClass:$(g).attr("class"),cornerStyle:$(g).attr("style")+" width:"+$(g).css("width")+"; height:"+$(g).css("height"),imgURL:$(g).children(".draggable").data("src"),imgURL_h:$(g).children(".draggable").data("src_h"),zdx:$(g).children(".draggable").data("zdx"),zdy:$(g).children(".draggable").data("zdy"),zw:$(g).children(".draggable").data("zw"),
zh:$(g).children(".draggable").data("zh")}),setTimeout(b,10);else{$status.after('<br><span style="font-size: 16px; color: white">'+$.i18n.prop("Msg_65")+"...</span>");var j=document.createElement("canvas");_show_save(j);$.post("db/save_image.php",{userid:$.cookie("user_id"),user_type:$.cookie("user_type"),title_name:TITLE_NAME,saveimag:JSON.stringify(c),phone_type:PHONE_NAME,layout_no:LAYOUT_NAME,phone_color:PHONE_COLOR,orig_img:j.toDataURL(),lang:MY_LANG},function(){TITLE_NAME="";$(j).attr("id",
"galleryCanvas");$(j).css("position","absolute");$(j).css("top","80px");$(j).css("left","200px");$(j).css("width",Math.round(0.7*$("#mCanvas")[0].width)+"px");$(j).css("height",Math.round(0.7*$("#mCanvas")[0].height)+"px");$("body").append($(j));$("#progress-bar").remove();$("#progress-bar")[0]=null;$wDiv.remove();$wDiv[0]=null;a()})}}$("body").append('<div class="modalOverlay"></div>');$wDiv=$(".modalOverlay");if(0!=$(".canvas_appended").length&&$(".canvas_appended").length==$(".layout_corner").length)if(""==
TITLE_NAME)Messi.alert($.i18n.prop("Msg_64")+' <input type="text">',function(a,b){TITLE_NAME=b;saveImg()},{title:$.i18n.prop("Msg_63"),modal:!0}),$wDiv.remove();else{$("body").append('<div id="progress-bar"><div id="status"></div></div>');$("#progress-bar").css("position","fixed");$("#progress-bar").css("z-index","1001");$("#progress-bar").css("top","337px");$("#progress-bar").css("left",layout_ox+40+"px");$status=$("#status");var c=[],e=100/$(".layout_corner").length,f=0,k=$("body").find(".layout_corner"),
h=0;b()}else new Messi($.i18n.prop("Msg_62"),{title:$.i18n.prop("Msg_63"),modal:!0}),$wDiv.remove()}
function _show_save(a){Math.round(parseInt($(".layout_corner").css("border-left-width"),10));var b=a.getContext("2d");$(a).attr("id","galleryCanvas");a.width=Math.round($("#mCanvas")[0].width);a.height=Math.round($("#mCanvas")[0].height);b.drawImage($("#mCanvas")[0],0,0,a.width,a.height);$(".canvas_appended").each(function(){b.drawImage($(this)[0],Math.round(parseInt($(this).css("left"),10))-layout_ox,Math.round(parseInt($(this).css("top"),10))-layout_oy,Math.round(parseInt($(this)[0].width,10)),
Math.round(parseInt($(this)[0].height,10)))})}
function _producing_for_factory(a,b){$("body").append('<div class="modalOverlay"></div>');$wDiv=$(".modalOverlay");$("body").append('<div id="progress-bar"><div id="status"></div></div>');$("#progress-bar").css("position","fixed");$("#progress-bar").css("z-index","1001");$("#progress-bar").css("top","300px");$("#progress-bar").css("left",layout_ox+"px");$status=$("#status");var c=new Image;c.src="images/"+b+"_mask3.png";c.onload=function(){function b(){var a=q[r++];if($(a).length){console.log("ready to get again");
var c;c="undefined"==typeof a.imgURL_h?a.imgURL.split("hotprintcloud.com/proxy/tmp/")[1].replace(/\+/g,"/"):a.imgURL_h.split("hotprintcloud.com/proxy/tmp/")[1].replace(/\+/g,"/");$.ajax({type:"GET",url:HOST_URL+"proxy/getImageData.php",data:{url:c},async:!1});console.log("get complete");$status.css("width",function(){j+=g;return j+"%"});c=a.cornerStyle.split(";");var m={},n="",p;for(p in c)n=c[p].split(":"),m[$.trim(n[0])]=$.trim(n[1]);var d=$("<div></div>");d.css("position","absolute");d.css("top",
Math.round(parseInt(m.top),10)*scaling+"px");d.css("left",Math.round(parseInt(m.left),10)*scaling+"px");d.css("width",Math.round(parseInt(m.width),10)*scaling+"px");d.css("height",Math.round(parseInt(m.height),10)*scaling+"px");d.css("border","6px solid silver");d.addClass(a.cornerClass);d.attr("id",a.cornerId);$("body").append(d);var l=$("<img/>");"undefined"==typeof a.imgURL_h?(l.attr("src",a.imgURL),console.log("imgURL loading..."+a.imgURL)):(l.attr("src",a.imgURL_h),console.log("imgURL_h loading..."+
a.imgURL_h));l.load(function(){var c=new Image;if("undefined"!=typeof a.zdx){l.data("zdx",a.zdx*scaling);l.data("zdy",a.zdy*scaling);l.data("zw",a.zw*scaling);l.data("zh",a.zh*scaling);var f=$("<canvas>"),g=d.clone();f[0].width=parseInt(d.css("width"),10)+parseInt(d.css("border-left-width"),10);f[0].height=parseInt(d.css("height"),10)+parseInt(d.css("border-left-width"),10);autoClipper2(l[0],f,g,d);c.src=f[0].toDataURL();c.width=f[0].width;c.height=f[0].height}else c.src=l.attr("src");c.onload=function(){0<=
d.attr("class").indexOf("layout_circle")?doClipping(doMasking(c,h,d,layout_ox*scaling,layout_oy*scaling),d,cirClipper):0<=d.attr("class").indexOf("layout_square")&&doClipping(doMasking(c,h,d,layout_ox*scaling,layout_oy*scaling),d,boxClipper);k.drawImage(d.next()[0],Math.round(parseInt(d.next().css("left"),10))-layout_ox*scaling,Math.round(parseInt(d.next().css("top"),10))-layout_oy*scaling,Math.round(parseInt(d.next().css("width"),10)),Math.round(parseInt(d.next().css("height"),10)));d.next().remove();
d.next()[0]=null;d.remove();d[0]=null;setTimeout(b,10)}})}else mod_saveremote(f),delete f,f=null,$("#progress-bar").remove(),$("#progress-bar")[0]=null,$wDiv.remove(),$wDiv[0]=null}var f=document.createElement("canvas"),k=f.getContext("2d");f.width=Math.round(c.width);f.height=Math.round(c.height);var h=document.createElement("canvas");h.width=c.width;h.height=c.height;h.getContext("2d").drawImage(c,0,0);var g=100/a.length,j=0,q=a,r=0;b()}}
function mod_saveremote(a){var b=$("<img>");b.attr("id","galleryCanvas");b.css("position","absolute");b.css("top","80px");b.css("left","100px");b.css("width",Math.round(0.7*a.width.width)+"px");b.css("height",Math.round(0.7*a.width.height)+"px");$("body").append(b);$("#galleryCanvas")[0].src=a.toDataURL()}
function setDragObj(a){a.children(".draggable").draggable({scroll:!1,cursor:"auto",cursorAt:{left:35,top:35},revert:"valid",drag:function(){0<=$(this).attr("class").indexOf("ui-draggable-dragging")&&($(this).parent().css("z-index","1000"),$(this).css("opacity","0.7"))},start:function(){disable_scroll();$(this).height($(this).data("oh")).width($(this).data("ow"));$(".layout_corner").css("z-index","998");$(".layout_corner").stop(!0,!0).animate({opacity:1});$(this).data("corner",$(this).parent())},stop:function(){enable_scroll();
0<=$(this).parent().attr("class").indexOf("removed")&&(removeUnclearWarning($(this).parent().attr("id")),clearCorner($(this).parent()))}});a.children(".draggable").css("z-index","");a.removeClass("removed");a.children(".draggable").removeClass("ui-draggable-dragging");a.css("cursor","move");a.css("z-index","998")}
function mod_randesign(){0<$(".layout_corner").children(".spinner").length||(0!=$(".canvas_appended").length?($("body").append('<div class="modalOverlay"></div>'),new Messi($.i18n.prop("Msg_66"),{title:$.i18n.prop("Msg_67"),buttons:[{id:0,label:"Yes",val:"Y"},{id:1,label:"No",val:"N"}],callback:function(a){"Y"===a&&_randesign();$(".modalOverlay").remove();$(".layout_corner").animate({opacity:CORNER_OPT})}})):_randesign())}
function _randesign(){$(".layout_corner").css("opacity",CORNER_OPT);$(".layout_corner").html("");$(".layout_corner > draggable").each(function(){$(this).remove();$(this)[0]=null});$(".canvas_appended").each(function(){$(this).remove();$(this)[0]=null});$(".layout_corner").each(function(){var a=Math.floor(Math.random()*$(".gallery-pool").length);$(this).append($($(".gallery-pool")[a]).clone());$(this).children(".draggable").removeClass("gallery-pool");$(this).children(".draggable").data("oh",Math.round(0.7*
$(".gallery-pool")[a].height));$(this).children(".draggable").data("ow",Math.round(0.7*$(".gallery-pool")[a].width));$(this).children(".draggable").css({position:"relative",top:"0px",left:"0px",width:$(this).css("width"),height:$(this).css("height"),opacity:"0"});var a=$(this).children(".draggable").attr("src"),b=$(this),c=HOST_URL+TEMP_DIR+a.replace(/\//g,"+");$(this).children(".draggable").data("src",c);c=HOST_URL+TEMP_DIR+$(this).children(".draggable").attr("delay_src_h").replace(/\//g,"+");$(this).children(".draggable").data("src_h",
c);c="#000";"black"==PHONE_COLOR&&(c="#FFF");var e=(new Spinner({lines:13,length:7,width:4,radius:10,corners:1,rotate:0,color:c,speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2E9,top:"auto",left:"auto"})).spin($(this)[0]);$.getImageData({url:a,server:HOST_URL+"proxy/getImageData.php",success:function(a){b.children(".draggable").attr("src",a.src);b.children(".draggable").addClass("cached");autoCentered(b,a);b.css("opacity","0");e.stop();setDragObj(b)},error:function(){e.stop()}})})}
function clearDesign(){!(0<$(".layout_corner").children(".spinner").length)&&0!=$(".canvas_appended").length&&($("body").append('<div class="modalOverlay"></div>'),new Messi($.i18n.prop("Msg_68"),{title:$.i18n.prop("Msg_69"),buttons:[{id:0,label:"Yes",val:"Y"},{id:1,label:"No",val:"N"}],callback:function(a){"Y"===a&&($(".layout_corner").length&&$(".layout_corner").children(".draggable").each(function(){$(this).remove();$(this)[0]=null}),$(".canvas_appended").length&&$(".canvas_appended").each(function(){$(this).remove();
$(this)[0]=null}));$(".modalOverlay").remove();$(".layout_corner").animate({opacity:CORNER_OPT})}}))}function styleOnload(a,b){a.attachEvent?a.attachEvent("onload",b):setTimeout(function(){poll(a,b)},0)}function poll(a,b){if(!b.isCalled){var c=!1;if(/webkit/i.test(navigator.userAgent))a.sheet&&(c=!0);else if(a.sheet)try{a.sheet.cssRules&&(c=!0)}catch(e){1E3===e.code&&(c=!0)}c?setTimeout(function(){b()},1):setTimeout(function(){poll(a,b)},1)}}var keys=[37,38,39,40];
function preventDefault(a){a=a||window.event;a.preventDefault&&a.preventDefault();a.returnValue=!1}function keydown(a){for(var b=keys.length;b--;)if(a.keyCode===keys[b]){preventDefault(a);break}}function wheel(a){preventDefault(a)}function disable_scroll(){window.addEventListener&&window.addEventListener("DOMMouseScroll",wheel,!1);window.onmousewheel=document.onmousewheel=wheel;document.onkeydown=keydown}
function enable_scroll(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",wheel,!1);window.onmousewheel=document.onmousewheel=document.onkeydown=null};